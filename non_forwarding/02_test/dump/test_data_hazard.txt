#----------------------------------------------------
# Mã Assembly RISC-V: Kiểm tra Data Hazard (Chỉ lệnh cơ bản)
# x30: 0x1000_0000 | x31: 0x1000_1000 | x29: 0x1000_2000
#----------------------------------------------------

# 1. KHỞI TẠO ĐỊA CHỈ & DỮ LIỆU
    lui x30, 0x10000   # x30 <- 0x10000000
    addi x30, x30, 0   # Hoàn tất x30

    addi x10, x0, 10   # x10 <- 10
    addi x11, x0, 20   # x11 <- 20
 
    sw x10, 0(x30)     
    # Giả định: Bộ nhớ 0x1000_0000 chứa giá trị 10 ban đầu
    # (Kết quả SW đầu tiên sẽ ghi 20)

#----------------------------------------------------
# 2. TEST LOAD-USE HAZARD (LW -> USE)

    lw x12, 0(x30)     # N:   x12 <- MEM[0x10000000] (Giả định là 10)
    add x13, x12, x10  # N+1: SỬ DỤNG x12
    sw x13, 0(x30)     # Xuất kết quả 20 ra 0x1000_0000

#----------------------------------------------------
# 3. TEST EX/MEM HAZARD (N -> N+1)

    addi x14, x0, 5    # x14 <- 5
    add x15, x10, x11  # N:   x15 <- 10 + 20 = 30
    sub x16, x15, x14  # N+1: SỬ DỤNG x15

    # Ghi kết quả ra 0x1000_1000
    lui x31, 0x10001
    addi x31, x31, 0
    sw x16, 0(x31)

#----------------------------------------------------
# 4. TEST MEM/WB HAZARD (N-1 -> N+1)

    addi x17, x0, 100  # x17 <- 100
    addi x18, x0, 50   # x18 <- 50
    sub x19, x17, x18  # N:   x19 <- 100 - 50 = 50
    addi x20, x19, 10  # N+1: SỬ DỤNG x19

    # Ghi kết quả ra 0x1000_2000
    lui x29, 0x10002
    addi x29, x29, 0
    sw x20, 0(x29)

#----------------------------------------------------
# 5. DỪNG CHƯƠNG TRÌNH
END_TEST:
    jal x0, END_TEST   # Vòng lặp vô tận